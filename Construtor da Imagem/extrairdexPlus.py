import os
from zipfile import ZipFile

arquivo = open("malware.csv","r")

listaHash = []
path_apk = "/home/jhogeremias/doutorado/dataset/malware/samples/"
path_dex = "/home/jhogeremias/doutorado/dataset/dex/"

for hashApk in arquivo:
    hashApk = hashApk.replace("\r","")
    hashApk = hashApk.replace("\n","")
    hashApk = hashApk.replace(".apk","")
    listaHash.append(hashApk)

for hashApk in listaHash:
    print(hashApk)

    try:
        comando = "cp "+path_apk+hashApk+".apk "+path_dex
        os.system(comando)
    
        z = ZipFile(path_dex+hashApk+".apk", 'r')
        z.extractall("./"+hashApk)
        z.close()
    
        comando = "mv ./"+hashApk+"/classes.dex ./files/"+hashApk+".dex"
        os.system(comando)
    
        comando = "rm -Rf ./"+hashApk
        os.system(comando)

        comando = "rm -f "+hashApk+".apk"
        os.system(comando)

    except: 
        with open("error.txt", "a+") as f:
            f.write(hashApk+"\n") 
